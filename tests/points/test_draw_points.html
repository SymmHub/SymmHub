<html>
<body>
<h1>Test Draw Points</h1>
<canvas id="glcanvas" width="1000" height="1000"></canvas>

<script>
const canvas = document.getElementById("glcanvas");
const gl = canvas.getContext("webgl2");

// Vertex shader
const vsSource = 
`#version 300 es
in vec2 a_color; // unused 
in vec2 a_position;

void main() {
    gl_PointSize = 1.;  // set size of each point
    gl_Position = vec4(a_position, 0.0, 1.0);
}`;

// Fragment shader
const fsSource = `#version 300 es
precision highp float;
out vec4 outColor;

void main() {
    outColor = vec4(1.0, 0.0, 0.0, 1.0);  // red points
}`;

// Helper to compile shader
function compileShader(type, source) {
    const shader = gl.createShader(type);
    gl.shaderSource(shader, source);
    gl.compileShader(shader);
    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
        console.error(gl.getShaderInfoLog(shader));
        gl.deleteShader(shader);
    }
    return shader;
}

// Create program
const vs = compileShader(gl.VERTEX_SHADER, vsSource);
const fs = compileShader(gl.FRAGMENT_SHADER, fsSource);
const program = gl.createProgram();
gl.attachShader(program, vs);
gl.attachShader(program, fs);
gl.linkProgram(program);
if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
    console.error(gl.getProgramInfoLog(program));
}
gl.useProgram(program);

// Array of points (clip space: -1 to 1)
let pcount = 10000;
let points = getSpiral(pcount, 0);
//let points = getSquare();

// Create buffer
const positionBuffer = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
gl.bufferData(gl.ARRAY_BUFFER, points, gl.DYNAMIC_DRAW);

// Bind attribute
const posAttrib = gl.getAttribLocation(program, "a_position");
gl.enableVertexAttribArray(posAttrib);
gl.vertexAttribPointer(posAttrib, 2, gl.FLOAT, false, 0, 0);

requestAnimationFrame(drawFrame);
let frameCount = 0;
const FRAME_TIME = (1./60);

function drawFrame(){

    // Clear canvas and draw
    gl.clearColor(1.0, 1.0, 1.0, 1.0);    
    gl.clear(gl.COLOR_BUFFER_BIT);
    
    gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
    points = getSpiral(pcount, FRAME_TIME*(frameCount++));
    gl.bufferData(gl.ARRAY_BUFFER, points, gl.STATIC_DRAW);
    
    gl.drawArrays(gl.POINTS, 0, pcount);
    if(frameCount < 60) requestAnimationFrame(drawFrame);
    
}

function getSpiral(count, time){

    const points = new Float32Array(2*count);
    let N = count;;
    for(let i = 0; i < N; i++){
        let phi = i*0.01 - 2.*Math.PI*time;
        let r = 1.5*i/N;
        let x = r*Math.cos(phi);
        let y = r*Math.sin(phi);
        points[2*i] = (x);
        points[2*i+1] = (y);
    } 
    return points;
        
}

function getSquare(){

    const points = new Float32Array([
       -0.5, -0.5,
        0.5, -0.5,
       -0.5,  0.5,
        0.5,  0.5,
        0.0,  0.0
    ]);
    return points;
}

</script>
</body>
</html>
